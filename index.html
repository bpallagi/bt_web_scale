<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>WH-C06 mÃ©rleg olvasÃ³</title>
</head>
<body>
  <h1>ğŸ”— WH-C06 Bluetooth mÃ©rleg</h1>
  <button id="connectBtn">CsatlakozÃ¡s a mÃ©rleghez</button>
  <p><strong>MÃ©rt sÃºly:</strong> <span id="weight">â€“</span></p>

  <script>
    const connectBtn = document.getElementById("connectBtn");
    const weightSpan = document.getElementById("weight");

    let device;
    let characteristic;

    connectBtn.addEventListener("click", async () => {
      try {
        device = await navigator.bluetooth.requestDevice({
          filters: [{ namePrefix: 'IF_' }],
          optionalServices: [0xFFF0, 0xFFE0] // KÃ¼lÃ¶nbÃ¶zÅ‘ firmwarek miatt prÃ³bÃ¡ljuk mindkettÅ‘t
        });

        const server = await device.gatt.connect();
        let service;
        try {
          service = await server.getPrimaryService(0xFFF0);
        } catch {
          service = await server.getPrimaryService(0xFFE0);
        }

        characteristic = await service.getCharacteristic(0xFFF4).catch(() =>
          service.getCharacteristic(0xFFE1)
        );

        await characteristic.startNotifications();
        characteristic.addEventListener('characteristicvaluechanged', handleWeightData);
        console.log("âœ… Csatlakozva a mÃ©rleghez");
      } catch (error) {
        console.error("âŒ Hiba a kapcsolat sorÃ¡n:", error);
      }
    });

    function handleWeightData(event) {
      const value = event.target.value;
      const raw = Array.from(new Uint8Array(value.buffer));
      console.log("ğŸ”¢ Nyers adat:", raw);

      // PÃ©lda: [0x02, 0x17, 0x02, 0x00, 0x00, 0x00, 0x00] => sÃºly a 2. Ã©s 3. byteban
      const weightGrams = raw[1] + (raw[2] << 8);
      const weightKg = (weightGrams / 100).toFixed(2);
      weightSpan.textContent = `${weightKg} kg`;
    }
  </script>
</body>
</html>
