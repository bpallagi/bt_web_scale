<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>WH-C06 Bluetooth mérleg</title>
    <script type="module">
      import { WHC06 } from "https://unpkg.com/@hangtime/grip-connect?module";

      document.addEventListener("DOMContentLoaded", () => {
        const connectBtn = document.getElementById("connectBtn");
        const output = document.getElementById("output");

        connectBtn.addEventListener("click", async () => {
          const device = new WHC06();

          try {
            await device.connect();
            device.notify((data) => {
              console.log("Kapott adat:", data);

              // Próbáljuk végig többféleképpen
              const val = data?.value ?? data?.measurement ?? JSON.stringify(data);
              const unit = data?.unit ?? '';
              const time = data?.timestamp ?? data?.time ?? '';

              output.textContent = `Mért érték: ${val} ${unit} (${new Date(time).toLocaleTimeString()})`;
          });

          } catch (e) {
            output.textContent = `Hiba: ${e.message}`;
          }
        });
      });
    </script>
  </head>
  <body>
    <h1>WH-C06 mérés</h1>
    <button id="connectBtn">Csatlakozás a mérleghez</button>
    <p id="output">Nincs adat</p>
  </body>
</html>
